# フィールド効果 第9世代仕様

**調査日**: 2026年2月1日  
**対象世代**: 第9世代（スカーレット・バイオレット）  
**調査範囲**: 天候、地形、グローバルフィールド、サイドフィールド

---

## 概要

第9世代におけるフィールド効果（天候、地形、グローバルフィールド、サイドフィールド）の仕様を包括的に調査。バトルの戦略性を決定する重要な要素として、全18種類のフィールド効果を実装。

---

## フィールドの分類

フィールド効果は以下の4つのカテゴリに分類されます：

1. **天候 (Weather)** - 排他的、バトル全体に影響
2. **地形 (Terrain)** - 排他的、バトル全体に影響（接地ポケモンのみ）
3. **グローバルフィールド (GlobalField)** - 複数同時可、バトル全体に影響
4. **サイドフィールド (SideField)** - 複数同時可、片側のみに影響

---

## 1. 天候 (Weather)

### 1.1 はれ（晴れ）

#### 基本効果
- ほのおタイプの技の威力が **1.5倍**
- みずタイプの技の威力が **0.5倍**
- かみなり・ぼうふうの命中率が **50%** に低下
- こおり状態が自然解凍されやすくなる

#### 特殊効果
- ソーラービーム・ソーラーブレードが **溜めなし** で使える
- せいちょうの効果が **2段階上昇** に強化
- あさのひざしなど天候回復技の回復量が **2/3** に増加

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **ターン延長アイテム**: あついいわ（8ターン）

#### 実装上の考慮事項
- イベント: `ON_CALC_POWER_MODIFIER` でタイプ別威力補正
- イベント: `ON_CHECK_ACCURACY` で命中率低下
- subject_spec: `"attacker:self"` でダメージ計算系

---

### 1.2 あめ（雨）

#### 基本効果
- みずタイプの技の威力が **1.5倍**
- ほのおタイプの技の威力が **0.5倍**
- かみなり・ぼうふうが **必中** になる

#### 特殊効果
- ソーラービーム・ソーラーブレードの威力が **0.5倍**
- あさのひざしなど天候回復技の回復量が **1/4** に減少

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **ターン延長アイテム**: しめったいわ（8ターン）

---

### 1.3 すなあらし（砂嵐）

#### 基本効果
- ターン終了時、いわ・じめん・はがねタイプ以外のポケモンに最大HPの **1/16** のダメージ
- いわタイプのポケモンの特防が **1.5倍**

#### 特殊効果
- ソーラービーム・ソーラーブレードの威力が **0.5倍**
- あさのひざしなど天候回復技の回復量が **1/4** に減少

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **ターン延長アイテム**: さらさらいわ（8ターン）

#### 実装状況
- ✅ ダメージ処理: `すなあらし_damage` ハンドラで実装済み
- ❌ 特防上昇効果: 未実装

---

### 1.4 ゆき（雪）

#### 基本効果
- こおりタイプのポケモンの防御が **1.5倍**
- ふぶきが **必中** になる
- オーロラベールが使用可能になる

#### 特殊効果
- ソーラービーム・ソーラーブレードの威力が **0.5倍**
- あさのひざしなど天候回復技の回復量が **1/4** に減少

#### 第9世代での変更点
- **「あられ」から「ゆき」に変更**
- **ダメージ効果が削除**（第8世代までは毎ターン1/16ダメージあり）
- **防御上昇効果を追加**（こおりタイプのポケモンの防御1.5倍）

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **ターン延長アイテム**: つめたいいわ（8ターン）

---

## 2. 地形 (Terrain)

**重要**: 地形効果は地面に接しているポケモンのみに適用されます。
- ひこうタイプのポケモン: 非接地
- 特性「ふゆう」のポケモン: 非接地
- じゅうりょく状態: 全て接地扱い

### 2.1 エレキフィールド

#### 基本効果
- でんきタイプの技の威力が **1.3倍**（使用者が地面に接している場合のみ）
- 地面に接しているポケモンは **ねむり状態にならない**
- 既にねむり状態のポケモンも目覚める

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **ターン延長アイテム**: グランドコート（8ターン）

---

### 2.2 グラスフィールド

#### 基本効果
- くさタイプの技の威力が **1.3倍**（使用者が地面に接している場合のみ）
- ターン終了時、地面に接しているポケモンのHPが最大HPの **1/16** 回復
- じしん・マグニチュード・じならしの威力が **0.5倍**

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **ターン延長アイテム**: グランドコート（8ターン）

#### 実装状況
- ✅ `グラスメイカー` 特性で発動処理の例が実装済み

---

### 2.3 サイコフィールド

#### 基本効果
- エスパータイプの技の威力が **1.3倍**（使用者が地面に接している場合のみ）
- 地面に接しているポケモンは **先制技の対象にならない**

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **ターン延長アイテム**: グランドコート（8ターン）

---

### 2.4 ミストフィールド

#### 基本効果
- ドラゴンタイプの技の威力が **0.5倍**（対象が地面に接している場合のみ）
- 地面に接しているポケモンは **状態異常・こんらん** にならない

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **ターン延長アイテム**: グランドコート（8ターン）

---

## 3. グローバルフィールド (GlobalField)

### 3.1 じゅうりょく（重力）

#### 基本効果
- 命中率が **5/3倍** になる
- 一撃必殺技が必中になる
- ひこうタイプ、特性ふゆうのポケモンも **地面技の対象** になる
- そらをとぶ・とびはねる・でんじふゆう・テレキネシスなどが **使用不可**
- フリーフォール状態のポケモンが地面に落ちる

#### 継続ターン数
- **5ターン**

---

### 3.2 トリックルーム

#### 基本効果
- 素早さの順序が **逆転** する（遅いポケモンから行動）
- 優先度は通常通り適用される

#### 継続ターン数
- **5ターン**

#### 実装上の考慮事項
- `speed_calculator.py` での実装が必要
- イベント: `ON_CALC_SPEED_ORDER` で順序逆転処理

---

## 4. サイドフィールド (SideField)

**重要**: サイドフィールドは片方のプレイヤー側の場にのみ影響します。
- ハンドラーは `Player` に登録される
- イベント発火時に `active` ポケモンに変換される
- テストでは `ally_side_field`/`foe_side_field` パラメータで設置可能

### 4.1 リフレクター

#### 基本効果
- 物理技のダメージを **0.5倍** に軽減（シングルバトル）
- ダブルバトルでは **2/3倍** に軽減
- かわらわりやサイコファング、すりぬけ特性で無効化

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **延長**: ひかりのねんど所持時 8ターン

#### 実装状況
- ✅ `リフレクター` ハンドラで一部実装済み

---

### 4.2 ひかりのかべ

#### 基本効果
- 特殊技のダメージを **0.5倍** に軽減（シングルバトル）
- ダブルバトルでは **2/3倍** に軽減
- かわらわりやサイコファング、すりぬけ特性で無効化

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **延長**: ひかりのねんど所持時 8ターン

---

### 4.3 しんぴのまもり

#### 基本効果
- 状態異常にならない（既に状態異常のポケモンは治らない）
- こんらんは防げない

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **延長**: ひかりのねんど所持時 8ターン

---

### 4.4 おいかぜ

#### 基本効果
- 素早さが **2倍** になる

#### 継続ターン数
- **4ターン**

---

### 4.5 まきびし

#### 基本効果
- ポケモン交代時にダメージ
  - **1層**: 最大HPの **1/8**
  - **2層**: 最大HPの **1/6**
  - **3層**: 最大HPの **1/4**
- ひこうタイプ、特性ふゆうには無効

#### スタック
- 最大 **3層** まで重ねがけ可能

---

### 4.6 どくびし

#### 基本効果
- ポケモン交代時に状態異常付与
  - **1層**: どく状態
  - **2層**: もうどく状態
- ひこうタイプ、特性ふゆうには無効
- どくタイプが交代で出ると **消滅**

#### スタック
- 最大 **2層** まで重ねがけ可能

---

### 4.7 ステルスロック

#### 基本効果
- ポケモン交代時にいわタイプ相性に応じたダメージ
  - **効果抜群（4倍）**: 最大HPの **1/2**
  - **効果抜群（2倍）**: 最大HPの **1/4**
  - **等倍**: 最大HPの **1/8**
  - **効果今ひとつ（1/2倍）**: 最大HPの **1/16**
  - **効果今ひとつ（1/4倍）**: 最大HPの **1/32**

#### スタック
- 重ねがけ不可

---

### 4.8 ねばねばネット

#### 基本効果
- ポケモン交代時に素早さランク **-1**
- ひこうタイプ、特性ふゆうには無効

#### スタック
- 重ねがけ不可

#### 実装上の考慮事項
- ランク変更には `battle.modify_stat()` を使用してイベントを発火する

---

### 4.9 オーロラベール

#### 基本効果
- リフレクターとひかりのかべの **両方の効果** を持つ
- 物理技・特殊技のダメージを **0.5倍** に軽減（シングルバトル）
- ダブルバトルでは **2/3倍** に軽減
- **ゆき（雪）天候時のみ使用可能**

#### 継続・延長
- **継続ターン数**: 5ターン（通常）
- **延長**: ひかりのねんど所持時 8ターン

---

## 実装マッピング

### イベントタイミング

| イベント | 用途 | 実装例 |
|---------|------|--------|
| ON_SWITCH_IN | フィールド発動（特性など） | グラスメイカー |
| ON_CHECK_DURATION | ターン延長アイテムの判定 | あついいわ、グランドコート |
| ON_TURN_END_2 | ターン終了時のダメージ・回復 | すなあらし、グラスフィールド |
| ON_CALC_POWER_MODIFIER | 威力補正 | はれ、あめ、地形 |
| ON_CALC_DAMAGE_MODIFIER | ダメージ補正 | リフレクター、ひかりのかべ |
| ON_CHECK_ACCURACY | 命中率判定 | じゅうりょく |
| ON_SWITCH_IN_AFTER | 交代後の効果 | まきびし、ステルスロック |

### フィールド管理クラス

| クラス | 管理対象 | 排他性 |
|-------|---------|--------|
| WeatherManager | 天候 | 排他的 |
| TerrainManager | 地形 | 排他的 |
| GlobalFieldManager | グローバルフィールド | 複数可 |
| SideFieldManager | サイドフィールド | 複数可 |

### ダメージ計算への影響（優先順位）

1. **天候による威力補正**（1.5倍 or 0.5倍）
2. **地形による威力補正**（1.3倍）
3. **リフレクター・ひかりのかべによる軽減**（0.5倍 or 2/3倍）

---

## 接地判定

地形効果の適用には地面接地判定が必要です：

| 状態 | 接地判定 |
|-----|---------|
| ひこうタイプのポケモン | 非接地 |
| 特性「ふゆう」のポケモン | 非接地 |
| でんじふゆう状態のポケモン | 非接地 |
| テレキネシス状態のポケモン | 非接地 |
| じゅうりょく状態 | 全て接地扱い |

**実装**: `Pokemon.is_floating(events)` メソッドで判定

---

## テスト方針

### 基本テスト項目

#### 天候
- ✅ 威力補正（1.5倍、0.5倍）の正確性
- ✅ ターン延長アイテムの効果
- ✅ ターン終了時ダメージ（すなあらし）

#### 地形
- ✅ 接地判定の正確性
- ✅ 威力補正（1.3倍）の正確性
- ✅ 状態異常防止（エレキフィールド、ミストフィールド）
- ✅ HP回復（グラスフィールド）

#### サイドフィールド
- ✅ ダメージ軽減（リフレクター、ひかりのかべ）
- ✅ 交代時ダメージ（まきびし、ステルスロック）
- ✅ 交代時状態異常（どくびし）
- ✅ 交代時ランク変化（ねばねばネット）

---

## 実装優先度

### 高優先度（対戦に必須）
1. ✅ 天候効果（はれ、あめ、すなあらし、ゆき）
2. ✅ 地形効果（エレキフィールド、グラスフィールド、サイコフィールド、ミストフィールド）
3. ✅ リフレクター、ひかりのかべ
4. ✅ ステルスロック、まきびし、どくびし

### 中優先度
1. トリックルーム
2. おいかぜ
3. しんぴのまもり
4. ねばねばネット
5. オーロラベール

### 低優先度
1. じゅうりょく

---

## 既知の制限事項

### 未実装項目
- すなあらしの特防上昇効果
- トリックルームの素早さ逆転
- じゅうりょくの効果全般
- オーロラベールの実装

### 今後の拡張ポイント
- ダブルバトル対応（リフレクター等の2/3倍軽減）
- フィールド破壊技（かわらわり、サイコファング）
- 特性「すりぬけ」との相互作用

---

## 参考資料

- [ポケモンWiki - 天候](https://wiki.xn--rckteqa2e.com/wiki/%E5%A4%A9%E5%80%99)
- [ポケモンWiki - フィールド](https://wiki.xn--rckteqa2e.com/wiki/%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89)
- [ポケモンWiki - 壁](https://wiki.xn--rckteqa2e.com/wiki/%E5%A3%81)

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-02-01 | 初版作成。.github/instructions/から移行 |

---

## 関連ドキュメント

- [実装コード: src/jpoke/handlers/field.py](../../src/jpoke/handlers/field.py)
- [データ定義: src/jpoke/data/field.py](../../src/jpoke/data/field.py)
- [フィールド管理: src/jpoke/core/field_manager.py](../../src/jpoke/core/field_manager.py)
- [テストコード: tests/field.py](../../tests/field.py)
- [ダッシュボード: dashboard.json](../../dashboard.json)
