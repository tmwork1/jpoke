# 揮発性状態 - 第9世代仕様調査

## 調査日
2026年2月1日

## 対象世代
第9世代（スカーレット・バイオレット）

## 調査範囲
揮発性状態の詳細仕様

---

## 実装済み揮発性状態

### 1. こんらん

#### 基本効果
- **継続ターン数**: 1～4ターン（ランダム）
- **効果**: 行動時に33%（1/3）の確率で自傷ダメージ（威力40、物理、タイプなし）
- **解除条件**: ターン経過、交代

#### 第9世代での変更点
- 第7世代から自傷確率が50% → 33%に変更（継続）

#### 実装上の考慮事項
- **イベント**: `イベント.ON_BEFORE_ACTION` - 行動前に判定
- **自傷ダメージ**: 威力40の物理技として計算（タイプ相性なし）
- **ダメージ計算式**: `(2 * level / 5 + 2) * 40 * A / D / 50 + 2`
- **確率制御**: `battle.test_option.ailment_trigger_rate`でテスト可能
- **エッジケース**:
  - 自分の攻撃と防御でダメージ計算
  - 特性「マイペース」で無効化

---

### 2. ちょうはつ

#### 基本効果
- **継続ターン数**: 3ターン
- **効果**: 変化技を使用できなくなる（攻撃技のみ使用可能）
- **解除条件**: ターン経過、交代

#### 第9世代での変更点
- なし（第7世代から仕様変更なし）

#### 実装上の考慮事項
- **イベント**: `イベント.ON_BEFORE_MOVE` - 技使用前に変化技かチェック
- **カウント管理**: `count=3` で初期化、`ON_TURN_END_5`で減少
- **エッジケース**: 
  - Zワザは防げない（攻撃技ベースのZワザは使用可能）
  - ダイマックス技は防げない

---

### 3. バインド（しめつける系）

#### 基本効果
- **継続ターン数**: 4～5ターン（第6世代以降）、拘束バンドで7ターン
- **効果**: 
  1. 交代・逃走不可
  2. ターン終了時に最大HPの1/8ダメージ（拘束バンドで1/6）
- **解除条件**: ターン経過、使用者が交代すると解除

#### 技リスト
- うずしお、からではさむ、しめつける、すなじごく、ほのおのうず
- マグマストーム、まきつく、まとわりつく

#### 第9世代での変更点
- なし

#### 実装上の考慮事項
- **イベント**: 
  - `イベント.ON_TURN_END_4` - ターン終了時ダメージ
  - `イベント.ON_CHECK_TRAPPED` - 交代制限
- **カウント管理**: `count=4～5` でランダム初期化
- **ダメージ分母**: `8`（拘束バンドで`6`）
- **エッジケース**:
  - ゴーストタイプは交代可能
  - 使用者が交代すると解除

---

### 4. メロメロ

#### 基本効果
- **継続ターン数**: 交代まで永続
- **効果**: 行動時に50%の確率で行動不能
- **発動条件**: 性別が異なるポケモン間のみ有効

#### 第9世代での変更点
- なし

#### 実装上の考慮事項
- **イベント**: `イベント.ON_BEFORE_ACTION` - 行動前に判定
- **確率制御**: `battle.test_option.ailment_trigger_rate = 0.5`
- **エッジケース**:
  - 性別不明（無性）には無効
  - 特性「どんかん」「アロマベール」で無効化

---

### 5. かなしばり

#### 基本効果
- **継続ターン数**: 4ターン
- **効果**: 直前に使用した技を使用不可にする
- **解除条件**: ターン経過、交代

#### 第9世代での変更点
- なし

#### 実装上の考慮事項
- **イベント**: `イベント.ON_BEFORE_MOVE` - 技使用前にチェック
- **記録内容**: `disabled_move_name: str` - 使用禁止の技名
- **エッジケース**:
  - PPが0でも関係なく禁止
  - 変身でコピーした技も対象

---

## 未実装の揮発性状態

### 6. アンコール

#### 基本効果
- **継続ターン数**: 3ターン
- **効果**: 直前に使用した技を連続で使わされる
- **解除条件**: ターン経過、交代、PPが0になる

#### 実装上の考慮事項
- **イベント**: `イベント.ON_BEFORE_MOVE` - 技選択時に固定
- **記録内容**: `locked_move_name: str` - 固定される技名
- **エッジケース**:
  - PPが0の技でも使わされる（わるあがきに変化）
  - 変身後は解除される
  - ダイマックス中は無効

---

### 7. じゅうでん

#### 基本効果
- **継続ターン数**: 次の電気技使用まで
- **効果**: 
  1. 次の電気技の威力2倍
  2. 特防1段階上昇
- **解除条件**: 電気技使用、交代

#### 実装上の考慮事項
- **イベント**: 
  - `イベント.ON_CALC_POWER_MODIFIER` - 威力2倍
  - 技使用後に自動解除
- **ランク補正**: 特防+1は即時適用
- **エッジケース**:
  - 電気技でなくても特防上昇は残る
  - Zワザ、ダイマックス技でも解除される

---

### 8. 急所ランク

#### 基本効果
- **継続ターン数**: 交代まで永続
- **効果**: 急所率を+1～+3段階上昇
- **解除条件**: 交代

#### 実装上の考慮事項
- **イベント**: ダメージ計算時の急所判定で参照
- **カウント管理**: `count=1～3` でランク保存
- **エッジケース**:
  - 技「きあいだめ」で+2
  - 特性「きょううん」と重複
  - 最大+4まで累積可能

---


## テスト方針

### 必須テスト項目
1. 基本効果の動作確認
2. ターン経過による解除
3. 交代による解除
4. エッジケース（特性による無効化等）

### 確率制御
`battle.test_option.ailment_trigger_rate`を使用して決定的なテストを実施

---

## 参考資料

- [ポケモンWiki - ちょうはつ](https://wiki.xn--rckteqa2e.com/wiki/%E3%81%A1%E3%82%87%E3%81%86%E3%81%AF%E3%81%A4)
- [ポケモンWiki - アンコール](https://wiki.xn--rckteqa2e.com/wiki/%E3%82%A2%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%AB)
- [ポケモンWiki - こんらん](https://wiki.xn--rckteqa2e.com/wiki/%E3%81%93%E3%82%93%E3%82%89%E3%82%93)
- [ポケモンWiki - バインド](https://wiki.xn--rckteqa2e.com/wiki/%E3%83%90%E3%82%A4%E3%83%B3%E3%83%89)

---

## 関連実装ファイル
- [実装コード: src/jpoke/data/volatile.py](../../src/jpoke/data/volatile.py)
- [ハンドラ: src/jpoke/handlers/volatile.py](../../src/jpoke/handlers/volatile.py)
- [モデル: src/jpoke/model/volatile.py](../../src/jpoke/model/volatile.py)
- [テスト: tests/volatile.py](../../tests/volatile.py)
