# 技の実装状況分析

**作成日:** 2026年2月4日  
**対象:** 第9世代ポケモンの技効果処理（759技）  
**担当:** PLN (Planner)  

---

## 概要

本ドキュメントは、`docs/research/move_gen9.md`の調査結果に基づいた **実装計画** です。

**位置付け:**
- 研究結果の実装段階への橋渡け
- 実装順序、優先度、アーキテクチャの判断
- 依存関係分析と実装フェーズの定義

---

## 実装済み効果処理

実装場所: `src/jpoke/data/models.py` (MoveData.flags)、`src/jpoke/handlers/`

| フラグ名 | 説明 | 実装状態 | 技数 | 備考 |
|----------|------|----------|------|------|
| **contact** | 接触技判定 | ✅ 実装済 | 約150技 | ポケモンに接触する技。アイテム発動条件に使用 |
| **bite** | 噛み技判定 | ✅ フラグ定義 | 11技 | かみくだく、かみつく等。追加効果未実装 |
| **punch** | パンチ技判定 | ✅ フラグ定義 | 24技 | かみなりパンチ等。追加効果未実装 |
| **sound** | 音技判定 | ✅ フラグ定義 | 33技 | おしゃべり、バークアウト等。音技無効化で使用 |
| **high_critical** | 急所に当たりやすい | ✅ 実装済 | 29技 | 急所ランク+1の効果を適用 |
| **charge** | 溜め技 | ⚠️ 部分実装 | 10技 | 2ターン技の仕様は実装。天候依存等は未 |
| **bullet** | 弾技判定 | ✅ フラグ定義 | 26技 | 追加効果未実装 |
| **slash** | 切り技判定 | ✅ フラグ定義 | 23技 | 急所率高い（high_critical対応） |
| **wave** | 波動技判定 | ✅ フラグ定義 | 6技 | 追加効果未実装 |
| **wind** | 風技判定 | ✅ フラグ定義 | 18技 | 天候操作で使用 |
| **switch** | 交代技 | ✅ 実装済 | 9技 | pivot()ハンドラで実装済み |

---

## 未実装効果処理一覧

以下の効果処理はフラグが定義されているか、またはユーザーデータに記載されていますが、実装されていません。

### 1. バインド・拘束系（bind）

**技:** しめつける、まきつく、ほのおのうず、からではさむ、すなじごく、マグマストーム、うずしお、まとわりつく、トラバサミ、サンダープリズン（11技）

**仕様:**
- 発動確率: 100%（確定発動）
- 効果: 相手を4-5ターン拘束、毎ターン最大HPの1/8ダメージ
- 拘束中は交代不可
- 解除条件: ターン数経過、交代不可状態の解除技

**実装要件:**
- 拘束状態のデータ構造（持続ターン数）
- 毎ターン終了時のダメージ処理
- 交代禁止フラグ
- 解除条件の判定

### 2. 時間経過ダメージ系（residual_damage）

**技:** しおづけ等（2ターン後に効果）

**仕様:**
- しおづけ: 2ターン後に相手が受けるダメージが増加 / 毎ターン最大HP/8ダメージ
- 発動確率: 100%
- 解除: ターン数経過、特定の技で解除

**実装要件:**
- ターンカウント機構
- 遅延効果の管理
- ダメージ修正値の適用

### 3. 隠れ状態・2ターン技（hide）

**技:** あなをほる、そらをとぶ、とびはねる、ゴーストダイブ、シャドーダイブ、ダイビング（6技）

**仕様:**
- 1ターン目: 隠れ状態になり、相手の攻撃を回避
- 2ターン目: 攻撃を実行
- 特性「接地」に影響: あなをほるは接地状態のポケモンにも当たる
- ターン数: 基本2ターン

**実装要件:**
- 隠れ状態フラグ
- ターン分割処理
- 回避判定の無効化

### 4. 回復技（heal）

**技:** かいふくしれい、じこさいせい、タマゴうみ、なまける、ミルクのみ、ねむる、あさのひざし、こうごうせい、つきのひかり等（24技）

**仕様（例）:**
- つきのひかり: 天候で効果変化（晴れ1/4、雨1/8、他）
- あさのひざし: 時間帯で効果変化（昼1/4、夜1/8）
- じこさいせい: 最大HPの1/2回復
- ねむる: 最大HP完全回復 + ねむり状態付与

**実装要件:**
- HPの回復処理
- 天候・時間帯による補正
- 状態異常の付与（ねむる等）

### 5. 反動で動けない技（immovable）

**技:** がんせきほう、ときのほうこう、はかいこうせん、ギガインパクト、ハイドロカノン、ハードプラント、ブラストバーン、プリズムレーザー（8技）

**仕様:**
- 技使用後、次ターン行動不可状態になる
- 相手に倒された場合は発動しない

**実装要件:**
- 次ターン行動不可フラグ
- 行動選択制限
- 相手が倒された場合の解除

### 6. 威力変動技（variable_power）

**技:** きしかいせい、くさむすび、けたぐり、じたばた、なげつける、にぎりつぶす、エレキボール、ジャイロボール、ハードプレス、ヒートスタンプ、ヘビーボンバー（11技）

**仕様:**
- けたぐり: 相手の体重で威力変化（20, 40, 60, 80, 120）
- ジャイロボール: 自分の速度/相手の速度で威力計算
- エレキボール: 自分の速度/相手の速度で威力計算
- ハードプレス: 相手HP/相手最大HPで威力計算

**実装要件:**
- 条件判定ロジック
- 威力計算式の統合
- ダメージ計算への適用

### 7. 能力変化無視（ignore_rank）

**技:** ＤＤラリアット、せいなるつるぎ（2技）

**仕様:**
- ダメージ計算において、相手の防御/特防ランク上昇を無視
- 相手のランク低下は反映される

**実装要件:**
- ダメージ計算時のランク無視判定

### 8. あばれる系（rage）

**技:** あばれる、げきりん、だいふんげき、はなびらのまい（4技）

**仕様:**
- 2-3ターン同じ技を使用し続ける
- 使用者が交代すると効果終了
- 効果終了後に混乱状態が付与される

**実装要件:**
- ターンカウント
- 強制行動フラグ
- 混乱付与処理

### 9. 一撃必殺技（one_ko）

**技:** じわれ、ぜったいれいど、つのドリル、ハサミギロチン（4技）

**仕様:**
- 相手をひんしにする
- 命中率: 30%（レベル差で補正）
- レベル差: 自分のレベル ≤ 相手のレベルの場合、命中率が下がる

**実装要件:**
- 命中判定の特殊化
- ひんし判定
- レベル差補正

### 10. 初ターンのみ有効（first_turn）

**技:** であいがしら、ねこだまし（2技）

**仕様:**
- であいがしら: 場に出た初ターンのみ威力が2倍、先制度+2
- ねこだまし: 場に出た初ターンのみ100%でひるみ、先制度+3

**実装要件:**
- ターンカウント
- 初ターン判定
- 優先度補正

### 11. 粉技（powder）

**技:** しびれごな、どくのこな、ねむりごな、わたほうし、キノコのほうし（5技）

**仕様:**
- 草タイプに命中率が75%に低下
- 砂嵐天候時は失敗
- 特性「エアロック」「気流」で無効化

**実装要件:**
- タイプ相性の特別化
- 防御特性の確認
- 天候影響

### 12. まもる技（protect）

**技:** かえんのまもり、こらえる、まもる、みきり、スレッドトラップ、トーチカ、ニードルガード、ファストガード（8技）

**仕様:**
- 100%で攻撃を無効化（優先度変動あり）
- 連続使用時は成功率が半分になる

**実装要件:**
- ターンのカウント
- 優先度処理
- 成功率低下ロジック

### 13. 連続攻撃技（multi_hit）

**技:** スイープビンタ、タネマシンガン、つっぱり、つららばり、みだれづき、ミサイルばり等

**仕様:**
- 2-5回の連続攻撃
- 各ヒット命中判定あり
- 全ヒット命中判定あり（1ヒット失敗で終了）

**実装要件:**
- ヒット回数の決定
- ループ処理
- ダメージ累積

### 14. 相手を強制交代（force_switch）

**技:** ドラゴンテール、ともえなげ、ふきとばし等

**仕様:**
- 相手を強制交代
- 後攻判定（優先度-6）
- 交代可能なポケモンがない場合は失敗

**実装要件:**
- 交代不可状態の確認
- 後続交代処理
- 優先度判定

### 15. 物理判定の特殊技（physical）

**技:** サイコショック、サイコブレイク、しんぴのつるぎ（3技）

**仕様:**
- 特殊技だが、相手の防御ランクを使用
- 相手の防御ランク上昇を考慮

**実装要件:**
- ダメージ計算式の変更
- 接触判定の確認

### 16. 雨天候下で必中（rainy_hit）

**技:** かみなり、かみなりあらし、こがらしあらし、ねっさのあらし、ぼうふう（5技）

**仕様:**
- 通常命中率が低い技が、雨天候下で100%命中

**実装要件:**
- 天候確認
- 命中判定の上書き

### 17. 天候・フィールド依存型（weather_dependent）

**技:** グラススライダー、ソーラービーム、ソーラーブレード等

**仕様:**
- グラススライダー: グラスフィールド下でのみ先制+1
- ソーラービーム: 晴れで即発動、雨時威力半減

**実装要件:**
- 天候確認ロジック
- 威力/効果の変更
- 先制度の変更

### 18. まもる貫通技（unprotectable）

**技:** いじげんホール、いじげんラッシュ、ゴーストダイブ、シャドーダイブ、ハイパードリル、パワフルエッジ、フェイント（7技）

**仕様:**
- 相手のまもるを無視して攻撃

**実装要件:**
- 防御状態判定の無視
- ダメージ計算への適用

### 19. 非反復技（unrepeatable）

**技:** デカハンマー、ブラッドムーン（2技）

**仕様:**
- 使用後、次ターンは使用できない

**実装要件:**
- 前ターン技の記録
- 技選択時の制限

### 20. 壁破壊技（break_wall）

**技:** かわらわり、サイコファング、レイジングブル（3技）

**仕様:**
- リフレクター等の壁を破壊

**実装要件:**
- 壁状態の確認・削除
- ダメージ計算への適用

### 21. 自己解凍技（unfreeze）

**技:** かえんぐるま、かえんボール、せいなるほのお、ねっさのだいち、ねっとう、もえつきる、クロスフレイム、シャカシャカほう、スチームバースト、ハイドロスチーム、フレアドライブ（12技）

**仕様:**
- こおり状態を解除して使用
- やけど状態の付与率向上

**実装要件:**
- こおり状態判定
- 状態解除処理

### 22. 特性無視技（ignore_ability）

**技:** シャドーレイ、フォトンゲイザー、メテオドライブ（3技）

**仕様:**
- 相手の特性を無視して攻撃

**実装要件:**
- 特性判定のスキップ
- 効果適用の確認

### 23. その他フラグ

| フラグ名 | 説明 | 技数 |
|----------|------|------|
| **non_encore** | アンコール対象外 | 8技 |
| **non_negoto** | ねごと対象外 | 18技 |
| **sleep** | ねむり状態でも使用可能 | 2技 |
| **call_move** | 他の技を呼び出す | 7技 |

---

## 未実装効果処理の優先度評価

| 優先度 | カテゴリ | 技数 | 難易度 | 理由 |
|--------|----------|------|--------|------|
| **最優先** | 能力変化無視 | 2 | ★★☆☆☆ | 実装が単純 |
| **最優先** | 物理判定 | 3 | ★★☆☆☆ | ダメージ計算の変更のみ |
| **高** | 雨必中 | 5 | ★★☆☆☆ | 天候判定を追加 |
| **高** | 威力変動技 | 11 | ★★★★☆ | 使用頻度が高い |
| **高** | 隠れ状態・2ターン技 | 6 | ★★★☆☆ | 基本的な効果 |
| **中** | バインド・拘束系 | 11 | ★★★★☆ | 複雑な状態管理 |
| **中** | 回復技 | 24 | ★★★☆☆ | 変化技として実装 |
| **中** | まもる技 | 8 | ★★★★☆ | 優先度の複雑さ |
| **中** | 連続攻撃 | 複数 | ★★★☆☆ | ループ処理 |
| **低** | 一撃必殺 | 4 | ★★★☆☆ | 使用頻度が低い |
| **低** | 初ターンのみ | 2 | ★★★☆☆ | 使用頻度が低い |
| **低** | あばれる系 | 4 | ★★★★☆ | 使用頻度が低い |
| **低** | その他 | 複数 | 変動 | ケース毎に判定 |

---

## 統計サマリー

### 全体統計

| カテゴリ | 技数 |
|----------|------|
| **総技数** | 759技（推定） |
| **追加効果なし** | 約150-200技 |
| **単純な追加効果あり** | 約240技（テーブル記載分） |
| **複雑な効果** | 約320-360技 |

### 効果別分類

| 効果タイプ | 技数 | 代表例 |
|------------|------|--------|
| **能力ランク↓（相手A）** | 13 | トロピカルキック、とびかかる、ワイドブレイカー |
| **能力ランク↓（相手B）** | 10 | かみくだく、アクアブレイク、いわくだき |
| **能力ランク↓（相手C）** | 7 | ソウルクラッシュ、バークアウト、マジカルフレイム |
| **能力ランク↓（相手D）** | 14 | だいちのちから、シャドーボール、エナジーボール |
| **能力ランク↓（相手S）** | 15 | じならし、こごえるかぜ、がんせきふうじ |
| **命中率↓（相手）** | 9 | だくりゅう、どろばくだん、ナイトバースト |
| **能力ランク↑（自分A）** | 4 | メタルクロー、コメットパンチ、グロウパンチ |
| **能力ランク↑（自分B）** | 3 | はがねのつばさ、ダイヤストーム、バリアーラッシュ |
| **能力ランク↑（自分C）** | 4 | チャージビーム、しんぴのちから、フレアソング |
| **能力ランク↑（自分S）** | 6 | アクアステップ、ニトロチャージ、くさわけ |
| **全能力↑（自分）** | 3 | あやしいかぜ、げんしのちから、ぎんいろのかぜ |
| **どく付与** | 17 | どくづき、ヘドロばくだん、スモッグ |
| **まひ付与** | 20 | 10まんボルト、かみなりパンチ、でんじほう |
| **やけど付与** | 23 | かえんほうしゃ、ねっとう、だいもんじ |
| **こおり付与** | 8 | れいとうビーム、ふぶき、こおりのキバ |
| **混乱付与** | 14 | サイケこうせん、みずのはどう、ばくれつパンチ |
| **ひるみ付与** | 37 | いわなだれ、エアスラッシュ、アイアンヘッド |
| **HP吸収** | 12 | ギガドレイン、きゅうけつ、ドレインパンチ |
| **反動ダメージ** | 13 | すてみタックル、フレアドライブ、ワイルドボルト |
| **失敗時反動** | 4 | とびげり、とびひざげり、かかとおとし |
| **HPコスト（自爆）** | 4 | じばく、だいばくはつ、クロロブラスト |

---

## 実装フェーズ（推奨順序）

### Phase 1: 基礎ダメージ計算拡張（1-2週間）
- 能力変化無視（ignore_rank）
- 物理判定の特殊技（physical）
- 依存: `src/jpoke/core/damage.py`

### Phase 2: 天候・条件判定（1-2週間）
- 雨天候下で必中（rainy_hit）
- 天候・フィールド依存型（weather_dependent）
- 依存: 天候システムの完成

### Phase 3: 威力計算拡張（2-3週間）
- 威力変動技（variable_power）
- けたぐり、ジャイロボール等の実装

### Phase 4: 状態管理（2-3週間）
- 拘束状態（bind）
- 行動不可状態（immovable）
- 時間経過ダメージ（residual_damage）

### Phase 5: その他の複雑な効果（3-4週間）
- 連続攻撃技（multi_hit）
- まもる技（protect）
- あばれる系（rage）

---

**ドキュメント管理者:** PLN (Planner)  
**最終更新日:** 2026年2月4日
